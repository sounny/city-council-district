<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Detroit City Council District Map</title>

  <!-- ArcGIS API CSS and JavaScript -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.25/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.25/"></script>

  <!-- Custom styles for full-screen map and button -->
  <style>
    html, body, #viewDiv {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }

    .addRecordBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: #0079c1;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      text-decoration: none;
    }

    .addRecordBtn:hover {
      background-color: #005a87;
    }
  </style>
  
  <!-- ArcGIS map configuration and widgets with expandable containers and home button -->
  <script>
    require([
      "esri/config",
      "esri/Map",
      "esri/views/MapView",
      "esri/widgets/BasemapGallery",
      "esri/widgets/Search",
      "esri/widgets/Home",
      "esri/layers/FeatureLayer",
      "esri/widgets/Legend",
      "esri/widgets/Expand",
      "esri/tasks/QueryTask",
      "esri/tasks/support/Query"
    ], function (esriConfig, Map, MapView, BasemapGallery, Search, Home, FeatureLayer, Legend, Expand, QueryTask, Query) {
      esriConfig.apiKey = "AAPK9010d0b61469421388268a0a3d6b9970behQAuDdJqQ1pqWiFduaupUbAQXKrMzBGDNlYvnzFhJVmo4o4_JV_Y0cDx9Umj8M";

      const map = new Map({
        basemap: "dark-gray"
      });

      const view = new MapView({
        container: "viewDiv",
        map: map,
        center: [-83.046, 42.34],
        zoom: 11
      });

      const basemapGallery = new BasemapGallery({
        view: view
      });
      const expandBasemap = new Expand({
        view: view,
        content: basemapGallery,
        expandIconClass: "esri-icon-basemap",
        expanded: false
      });

      view.ui.add(expandBasemap, "top-left");

      const home = new Home({
        view: view
      });
      view.ui.add(home, "top-left");

      const cityCouncil = new FeatureLayer({
        url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/CityCouncilDistrict/FeatureServer/0",
        outFields: ["*"],
        popupTemplate: {
          title: "City Council District {District_N}",
          content: "This is City Council District {District_N}"
        }
      });

      map.add(cityCouncil);

      const search = new Search({
        view: view,
        allPlaceholder: "Search for address",
        includeDefaultSources: false,
        sources: [{
          locator: new esri.tasks.Locator({
            url: "https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"
          }),
          singleLineFieldName: "SingleLine",
          name: "Address Search",
          localSearchOptions: {
            minScale: 300000,
            distance: 50000
          },
          placeholder: "Search for an address",
          maxResults: 3,
          maxSuggestions: 6,
          suggestionsEnabled: true,
          minSuggestCharacters: 0
        }]
      });

      const expandSearch = new Expand({
        view: view,
        content: search,
        expandIconClass: "esri-icon-search",
        expanded: true
      });

      search.on("select-result", function(event) {
        const query = new Query();
        query.geometry = event.result.feature.geometry; // use the geometry of the searched location
        query.returnGeometry = true;
        query.outFields = ["*"];

        cityCouncil.queryFeatures(query).then(function(response){
          if (response.features.length > 0) {
            const feature = response.features[0];
            view.popup.open({
              title: `City Council District ${feature.attributes.District_N}`,
              content: `The searched address is in City Council District ${feature.attributes.District_N}.`,
              location: event.result.feature.geometry
            });
          } else {
            view.popup.open({
              title: "No District Found",
              content: "The searched address is not within any city council district.",
              location: event.result.feature.geometry
            });
          }
        });
      });

      view.ui.add(expandSearch, "top-right");

      const legend = new Legend({
        view: view,
        layerInfos: [{
          layer: cityCouncil,
          title: "City Council Districts"
        }]
      });
      const expandLegend = new Expand({
        view: view,
        content: legend,
        expandIconClass: "esri-icon-layer-list",
        expanded: true
      });

      view.ui.add(expandLegend, "bottom-right");
    });
  </script>
</head>
<body>
  <div id="viewDiv"></div>
</body>
</html>
